<template>
  <div class="hello">
    <!-- <h1>{{ msg }}</h1>
    <h1>å½“å‰éº¦å…‹é£æˆæƒçŠ¶æ€ï¼š{{isUseMic?'å·²å…è®¸':'ç¦æ­¢'}}</h1>
    <p v-if="pageInfo">
      å½“å‰é¡µé¢ä¿¡æ¯ï¼š{{ pageInfo }}
    </p>
    <p id="m-plugin-wrap">
      æ¥æ”¶åˆ°åå°æ¶ˆæ¯å•¦ï¼š{{ message }}
    </p>
    <router-link to="login">è·³è½¬</router-link>
    <button @click="local">ç¼“å­˜</button>
    <button @click="login">ç™»å½•</button> -->
    <p style="width: 200px;">å½“å‰åŸŸæš‚æ— ä½¿ç”¨æƒé™</p>
  </div>
</template>

<script>
import { getCurrentInstance, onBeforeMount, onMounted, reactive, toRefs, watch } from 'vue'
export default {
  name: 'HelloWorld',
  props: {
    msg: String
  },
  setup() {
    const { proxy } = getCurrentInstance()
    const state = reactive({
      id: '',
      message: '',
      pageInfo: null,
      audioValue: 'default',
      isUseMic: false,
    })
    onBeforeMount(()=>{
      // chrome.runtime.onMessage.addListener((data, sender, sendResponse) => {
      //   if (data.active) {
      //     switch (data.active) {
      //       case 'mediaDevices':
      //         state.isUseMic = data.status
      //         break;
      //       case 'activeTab':
      //         state.pageInfo = data.tabInfo
      //         break;
      //     }
      //   } else {
      //     console.log("ğŸ˜æ”¶åˆ°æ¶ˆæ¯ï¼š", data);
      //     sendResponse("ğŸ˜è¿™æ˜¯æ¥è‡ªpopupçš„å“åº”");
      //   }
      //   document.getElementById('m-plugin-wrap').style.display = 'block'
      // })
    })
    onMounted(async () => {
      // document.addEventListener('DOMContentLoaded', function() {
        // chrome.runtime.sendMessage({ active: 'popupLoaded' }, (response) => {
        //   getAudioStatus()
        // });
      // });
    })
    
    const local = e => {
      // è·å–æœ¬åœ°å­˜å‚¨æ•°æ®
      // chrome.storage.local.get(['isUseMic'], function(result) {
      //   console.log('chromeæœ¬åœ°æ•°æ®ï¼š', result);
      // });
    }
    const getAudioStatus = e => {
      // chrome.storage.local.get(['isUseMic'], function(result) {
      //   if (typeof result.isUseMic == 'boolean') {
      //     state.isUseMic = result.isUseMic || state.pageInfo.isUseMic || ''
      //   } else {
      //     chrome.runtime.sendMessage({active: "getMediaDevices" }, function(response) {
      //       console.log("ğŸ“Œæ”¶åˆ°backgroundçš„å“åº”ï¼š", response);
      //       state.isUseMic = response.isUseMic
      //     });
      //   }
      // });
    }
    const login = e => {
      // const getViews = chrome.extension.getViews();
      // console.log(getViews)
      // const getBackgroundPage = chrome.extension.getBackgroundPage();
      // console.log(getBackgroundPage)
    }
 
    return {
      ...toRefs(state),
      local,
      login,
    }
  }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>

</style>
